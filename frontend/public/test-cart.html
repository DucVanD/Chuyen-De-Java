<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Sync Test Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 25px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-section h2 {
            color: #34495e;
            font-size: 18px;
            margin-bottom: 15px;
        }
        .status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .status.pass { background: #2ecc71; color: white; }
        .status.fail { background: #e74c3c; color: white; }
        .status.warning { background: #f39c12; color: white; }
        .result {
            margin: 10px 0;
            padding: 15px;
            background: white;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .instruction {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Cart Synchronization Test Tool</h1>
        <p>C√¥ng c·ª• ki·ªÉm tra t·ª± ƒë·ªông ƒë·ªìng b·ªô gi·ªè h√†ng gi·ªØa Frontend v√† Backend</p>

        <!-- Test 1: Authentication -->
        <div class="test-section">
            <h2>Test 1: Ki·ªÉm Tra ƒêƒÉng Nh·∫≠p</h2>
            <button onclick="checkAuth()">‚ñ∂ Ch·∫°y Test</button>
            <div id="auth-result"></div>
        </div>

        <!-- Test 2: LocalStorage Cart -->
        <div class="test-section">
            <h2>Test 2: Ki·ªÉm Tra Gi·ªè H√†ng LocalStorage</h2>
            <button onclick="checkLocalCart()">‚ñ∂ Ch·∫°y Test</button>
            <div id="localcart-result"></div>
        </div>

        <!-- Test 3: Backend Connection -->
        <div class="test-section">
            <h2>Test 3: Ki·ªÉm Tra K·∫øt N·ªëi Backend</h2>
            <button onclick="testBackend()">‚ñ∂ Ch·∫°y Test</button>
            <div id="backend-result"></div>
        </div>

        <!-- Test 4: Admin API -->
        <div class="test-section">
            <h2>Test 4: Ki·ªÉm Tra Admin API (C·∫ßn Token Admin)</h2>
            <button onclick="testAdminAPI()">‚ñ∂ Ch·∫°y Test</button>
            <div id="admin-result"></div>
        </div>

        <!-- Instructions -->
        <div class="instruction">
            <strong>üìã H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</strong><br>
            1. M·ªü file n√†y trong tr√¨nh duy·ªát sau khi frontend ƒëang ch·∫°y<br>
            2. ƒê·∫£m b·∫£o b·∫°n ƒëang ·ªü trang web (http://localhost:5173)<br>
            3. Ch·∫°y t·ª´ng test theo th·ª© t·ª±<br>
            4. N·∫øu Test 1 FAIL ‚Üí B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p tr∆∞·ªõc!<br>
            5. N·∫øu Test 2 c√≥ items nh∆∞ng Test 4 kh√¥ng c√≥ ‚Üí B·∫°n th√™m s·∫£n ph·∫©m khi ch∆∞a ƒëƒÉng nh·∫≠p!
        </div>
    </div>

    <script>
        function checkAuth() {
            const result = document.getElementById('auth-result');
            const token = localStorage.getItem('token');
            
            if (token) {
                result.innerHTML = `
                    <div class="result">
                        <span class="status pass">‚úì PASS</span>
                        <p><strong>Tr·∫°ng th√°i:</strong> ƒê√£ ƒëƒÉng nh·∫≠p</p>
                        <p><strong>Token:</strong> ${token.substring(0, 50)}...</p>
                        <p style="color: #27ae60;">‚úì Gi·ªè h√†ng s·∫Ω ƒë·ªìng b·ªô v·ªõi backend khi th√™m s·∫£n ph·∫©m</p>
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="result">
                        <span class="status fail">‚úó FAIL</span>
                        <p><strong>Tr·∫°ng th√°i:</strong> CH∆ØA ƒëƒÉng nh·∫≠p</p>
                        <p style="color: #e74c3c;">‚úó Gi·ªè h√†ng CH·ªà l∆∞u trong localStorage</p>
                        <p style="color: #e74c3c;">‚úó Admin KH√îNG th·ªÉ xem gi·ªè h√†ng c·ªßa b·∫°n</p>
                        <button onclick="window.location.href='/registered'">ƒêi t·ªõi trang ƒëƒÉng nh·∫≠p</button>
                    </div>
                `;
            }
        }

        function checkLocalCart() {
            const result = document.getElementById('localcart-result');
            const cartItems = localStorage.getItem('cartItems');
            
            if (cartItems) {
                const items = JSON.parse(cartItems);
                const itemsList = items.map(item => `
                    <li>${item.name} (x${item.qty}) - ${(item.discountPrice || item.salePrice).toLocaleString()}‚Ç´</li>
                `).join('');
                
                result.innerHTML = `
                    <div class="result">
                        <span class="status pass">‚úì PASS</span>
                        <p><strong>S·ªë l∆∞·ª£ng s·∫£n ph·∫©m:</strong> ${items.length}</p>
                        <ul>${itemsList}</ul>
                        ${!localStorage.getItem('token') ? 
                            '<p style="color: #f39c12;">‚ö† C·∫£nh b√°o: B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p! Nh·ªØng s·∫£n ph·∫©m n√†y CH·ªà t·ªìn t·∫°i trong tr√¨nh duy·ªát.</p>' : 
                            '<p style="color: #27ae60;">‚úì N·∫øu b·∫°n v·ª´a th√™m nh·ªØng s·∫£n ph·∫©m n√†y sau khi ƒëƒÉng nh·∫≠p, ch√∫ng ƒë√£ ƒë∆∞·ª£c ƒë·ªìng b·ªô l√™n server.</p>'
                        }
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="result">
                        <span class="status warning">‚ö† WARNING</span>
                        <p>LocalStorage kh√¥ng c√≥ s·∫£n ph·∫©m n√†o</p>
                        <p>Kh·∫£ nƒÉng: Gi·ªè h√†ng tr·ªëng HO·∫∂C ƒë√£ ƒë∆∞·ª£c ƒë·ªìng b·ªô v·ªõi backend</p>
                    </div>
                `;
            }
        }

        async function testBackend() {
            const result = document.getElementById('backend-result');
            result.innerHTML = '<p>ƒêang ki·ªÉm tra...</p>';
            
            try {
                const response = await fetch('http://localhost:8080/api/products', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    result.innerHTML = `
                        <div class="result">
                            <span class="status pass">‚úì PASS</span>
                            <p><strong>Backend Status:</strong> Running</p>
                            <p><strong>URL:</strong> http://localhost:8080</p>
                            <p style="color: #27ae60;">‚úì Backend ƒëang ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng</p>
                        </div>
                    `;
                } else {
                    throw new Error('Backend responded with error');
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="result">
                        <span class="status fail">‚úó FAIL</span>
                        <p><strong>L·ªói:</strong> Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c backend</p>
                        <p style="color: #e74c3c;">Vui l√≤ng ki·ªÉm tra backend c√≥ ƒëang ch·∫°y kh√¥ng (port 8080)</p>
                        <div class="code">Error: ${error.message}</div>
                    </div>
                `;
            }
        }

        async function testAdminAPI() {
            const result = document.getElementById('admin-result');
            const token = localStorage.getItem('token');
            
            if (!token) {
                result.innerHTML = `
                    <div class="result">
                        <span class="status fail">‚úó FAIL</span>
                        <p>B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ ch·∫°y test n√†y</p>
                    </div>
                `;
                return;
            }
            
            result.innerHTML = '<p>ƒêang ki·ªÉm tra admin API...</p>';
            
            try {
                const response = await fetch('http://localhost:8080/api/admin/carts', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const carts = await response.json();
                    result.innerHTML = `
                        <div class="result">
                            <span class="status pass">‚úì PASS</span>
                            <p><strong>S·ªë l∆∞·ª£ng gi·ªè h√†ng trong database:</strong> ${carts.length}</p>
                            ${carts.length > 0 ? `
                                <p><strong>Chi ti·∫øt:</strong></p>
                                <ul>
                                    ${carts.map(cart => `
                                        <li>Cart ID: ${cart.id} - User: ${cart.user.name} - Items: ${cart.items.length}</li>
                                    `).join('')}
                                </ul>
                                <p style="color: #27ae60;">‚úì Gi·ªè h√†ng ƒë√£ ƒë∆∞·ª£c ƒë·ªìng b·ªô th√†nh c√¥ng!</p>
                            ` : `
                                <p style="color: #f39c12;">‚ö† Ch∆∞a c√≥ gi·ªè h√†ng n√†o trong database</p>
                                <p>Nguy√™n nh√¢n: Ch∆∞a c√≥ user n√†o ƒëƒÉng nh·∫≠p v√† th√™m s·∫£n ph·∫©m</p>
                            `}
                        </div>
                    `;
                } else if (response.status === 401) {
                    result.innerHTML = `
                        <div class="result">
                            <span class="status fail">‚úó FAIL</span>
                            <p><strong>L·ªói:</strong> Unauthorized (401)</p>
                            <p style="color: #e74c3c;">Token kh√¥ng h·ª£p l·ªá ho·∫∑c b·∫°n kh√¥ng ph·∫£i Admin</p>
                            <p>Vui l√≤ng ƒëƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n Admin</p>
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="result">
                        <span class="status fail">‚úó FAIL</span>
                        <p><strong>L·ªói:</strong> ${error.message}</p>
                        <p style="color: #e74c3c;">Kh√¥ng th·ªÉ g·ªçi Admin API</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
